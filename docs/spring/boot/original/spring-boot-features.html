<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Spring Boot Features</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style type="text/css">
body {
	font-family: 'Malgun Gothic', '맑은 고딕', dotum, '돋움', sans-serif
}
</style>
<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}
</style>
<script type="text/javascript">
function addBlockSwitches() {
	for (var primary of document.querySelectorAll('.primary')) {
		var switchItem = createSwitchItem(primary, createBlockSwitch(primary));
		switchItem.item.classList.add("selected");
		var title = primary.querySelector('.title')
		title.remove();
	}
	for (var secondary of document.querySelectorAll('.secondary')) {
		var primary = findPrimary(secondary);
		if (primary === null) {
			console.error("Found secondary block with no primary sibling");
		}
		else {
			var switchItem = createSwitchItem(secondary, primary.querySelector('.switch'));
			switchItem.content.classList.add("hidden");
			primary.append(switchItem.content);
			secondary.remove();
		}
	}
}

function createElementFromHtml(html) {
	var template = document.createElement('template');
    template.innerHTML = html;
    return template.content.firstChild;
}

function createBlockSwitch(primary) {
    var blockSwitch = createElementFromHtml('<div class="switch"></div>');
    primary.prepend(blockSwitch)
	return blockSwitch;
}

function findPrimary(secondary) {
	var candidate = secondary.previousElementSibling;
	while (candidate != null && !candidate.classList.contains('primary')) {
		candidate = candidate.previousElementSibling;
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	var blockName = block.querySelector('.title').textContent;
	var content = block.querySelectorAll('.content').item(0);
	var colist = block.querySelector('.colist')
	if (colist != null) {
		content.append();
	}
	var item = createElementFromHtml('<div class="switch--item">' + blockName + '</div>');
	item.dataset.blockName = blockName;
	content.dataset.blockName = blockName;
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function globalSwitch() {
	document.querySelectorAll(".switch--item").forEach(function(item) {
		var blockId = blockIdForSwitchItem(item);
		var handler = function(event) {
			selectedText = event.target.textContent;
			window.localStorage.setItem(blockId, selectedText);
			for (var switchItem of document.querySelectorAll(".switch--item")) {
				if (blockIdForSwitchItem(switchItem) === blockId && switchItem.textContent === selectedText) {
					select(switchItem);
				}
			}
		}
		item.addEventListener("click", handler);
		if (item.textContent === window.localStorage.getItem(blockId)) {
			select(item);
		}
	});
}

function select(selected) {
	for (var child of selected.parentNode.children) {
		child.classList.remove("selected");
	}
	selected.classList.add("selected");
	for (var child of selected.parentNode.parentNode.children) {
		if (child.classList.contains("content")) {
			if (selected.dataset.blockName === child.dataset.blockName) {
				child.classList.remove("hidden");
			}
			else {
				child.classList.add("hidden");
			}
		}
	}	
}

function blockIdForSwitchItem(item) {
	idComponents = []
	for (var switchItem of item.parentNode.querySelectorAll(".switch--item")) {
		idComponents.push(switchItem.textContent.toLowerCase());
	}
	return idComponents.sort().join("-")
}

window.onload = function() {
	addBlockSwitches();
	globalSwitch();
};
</script>

</head>
<body id="boot-features" class="book toc2 toc-left">
<div id="header">
<h1>Spring Boot Features</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#boot-features-logging">1. Logging</a>
<ul class="sectlevel2">
<li><a href="#boot-features-logging-format">1.1. Log Format</a></li>
<li><a href="#boot-features-logging-console-output">1.2. Console Output</a>
<ul class="sectlevel3">
<li><a href="#boot-features-logging-color-coded-output">1.2.1. Color-coded Output</a></li>
</ul>
</li>
<li><a href="#boot-features-logging-file-output">1.3. File Output</a></li>
<li><a href="#boot-features-logging-file-rotation">1.4. File Rotation</a></li>
<li><a href="#boot-features-custom-log-levels">1.5. Log Levels</a></li>
<li><a href="#boot-features-custom-log-groups">1.6. Log Groups</a></li>
<li><a href="#boot-features-log-shutdown-hook">1.7. Using a Log Shutdown Hook</a></li>
<li><a href="#boot-features-custom-log-configuration">1.8. Custom Log Configuration</a></li>
<li><a href="#boot-features-logback-extensions">1.9. Logback Extensions</a>
<ul class="sectlevel3">
<li><a href="#profile-specific-configuration">1.9.1. Profile-specific Configuration</a></li>
<li><a href="#environment-properties">1.9.2. Environment Properties</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#boot-features-testing">2. Testing</a>
<ul class="sectlevel2">
<li><a href="#boot-features-test-scope-dependencies">2.1. Test Scope Dependencies</a></li>
<li><a href="#boot-features-testing-spring-applications">2.2. Testing Spring Applications</a></li>
<li><a href="#boot-features-testing-spring-boot-applications">2.3. Testing Spring Boot Applications</a>
<ul class="sectlevel3">
<li><a href="#boot-features-testing-spring-boot-applications-detecting-web-app-type">2.3.1. Detecting Web Application Type</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-detecting-config">2.3.2. Detecting Test Configuration</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-excluding-config">2.3.3. Excluding Test Configuration</a></li>
<li><a href="#boot-features-testing-spring-boot-application-arguments">2.3.4. Using Application Arguments</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-with-mock-environment">2.3.5. Testing with a mock environment</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-with-running-server">2.3.6. Testing with a running server</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-customizing-web-test-client">2.3.7. Customizing WebTestClient</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-jmx">2.3.8. Using JMX</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-metrics">2.3.9. Using Metrics</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-mocking-beans">2.3.10. Mocking and Spying Beans</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">2.3.11. Auto-configured Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-json-tests">2.3.12. Auto-configured JSON Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests">2.3.13. Auto-configured Spring MVC Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests">2.3.14. Auto-configured Spring WebFlux Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-cassandra-test">2.3.15. Auto-configured Data Cassandra Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">2.3.16. Auto-configured Data JPA Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test">2.3.17. Auto-configured JDBC Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-data-jdbc-test">2.3.18. Auto-configured Data JDBC Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jooq-test">2.3.19. Auto-configured jOOQ Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mongo-test">2.3.20. Auto-configured Data MongoDB Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test">2.3.21. Auto-configured Data Neo4j Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-redis-test">2.3.22. Auto-configured Data Redis Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-ldap-test">2.3.23. Auto-configured Data LDAP Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-client">2.3.24. Auto-configured REST Clients</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs">2.3.25. Auto-configured Spring REST Docs Tests</a>
<ul class="sectlevel4">
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-mock-mvc">Auto-configured Spring REST Docs Tests with Mock MVC</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-web-test-client">Auto-configured Spring REST Docs Tests with WebTestClient</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-rest-assured">Auto-configured Spring REST Docs Tests with REST Assured</a></li>
</ul>
</li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-webservices">2.3.26. Auto-configured Spring Web Services Tests</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-auto-configured-additional-auto-config">2.3.27. Additional Auto-configuration and Slicing</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-testing-user-configuration">2.3.28. User Configuration and Slicing</a></li>
<li><a href="#boot-features-testing-spring-boot-applications-with-spock">2.3.29. Using Spock to Test Spring Boot Applications</a></li>
</ul>
</li>
<li><a href="#boot-features-test-utilities">2.4. Test Utilities</a>
<ul class="sectlevel3">
<li><a href="#boot-features-configfileapplicationcontextinitializer-test-utility">2.4.1. ConfigFileApplicationContextInitializer</a></li>
<li><a href="#boot-features-test-property-values">2.4.2. TestPropertyValues</a></li>
<li><a href="#boot-features-output-capture-test-utility">2.4.3. OutputCapture</a></li>
<li><a href="#boot-features-rest-templates-test-utility">2.4.4. TestRestTemplate</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="boot-features-logging"><a class="anchor" href="#boot-features-logging"></a>1. Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot uses <a href="https://commons.apache.org/logging">Commons Logging</a> for all internal logging but leaves the underlying log implementation open.
Default configurations are provided for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/logging/package-summary.html">Java Util Logging</a>, <a href="https://logging.apache.org/log4j/2.x/">Log4J2</a>, and <a href="https://logback.qos.ch/">Logback</a>.
In each case, loggers are pre-configured to use console output with optional file output also available.</p>
</div>
<div class="paragraph">
<p>By default, if you use the &#8220;Starters&#8221;, Logback is used for logging.
Appropriate Logback routing is also included to ensure that dependent libraries that use Java Util Logging, Commons Logging, Log4J, or SLF4J all work correctly.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There are a lot of logging frameworks available for Java.
Do not worry if the above list seems confusing.
Generally, you do not need to change your logging dependencies and the Spring Boot defaults work just fine.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When you deploy your application to a servlet container or application server, logging performed via the Java Util Logging API is not routed into your application&#8217;s logs.
This prevents logging performed by the container or other applications that have been deployed to it from appearing in your application&#8217;s logs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="boot-features-logging-format"><a class="anchor" href="#boot-features-logging-format"></a>1.1. Log Format</h3>
<div class="paragraph">
<p>The default log output from Spring Boot resembles the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2019-03-05 10:57:51.112  INFO 45469 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/7.0.52
2019-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2019-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1358 ms
2019-03-05 10:57:51.698  INFO 45469 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: 'dispatcherServlet' to [/]
2019-03-05 10:57:51.702  INFO 45469 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]</pre>
</div>
</div>
<div class="paragraph">
<p>The following items are output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Date and Time: Millisecond precision and easily sortable.</p>
</li>
<li>
<p>Log Level: <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, or <code>TRACE</code>.</p>
</li>
<li>
<p>Process ID.</p>
</li>
<li>
<p>A <code>---</code> separator to distinguish the start of actual log messages.</p>
</li>
<li>
<p>Thread name: Enclosed in square brackets (may be truncated for console output).</p>
</li>
<li>
<p>Logger name: This is usually the source class name (often abbreviated).</p>
</li>
<li>
<p>The log message.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Logback does not have a <code>FATAL</code> level.
It is mapped to <code>ERROR</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-logging-console-output"><a class="anchor" href="#boot-features-logging-console-output"></a>1.2. Console Output</h3>
<div class="paragraph">
<p>The default log configuration echoes messages to the console as they are written.
By default, <code>ERROR</code>-level, <code>WARN</code>-level, and <code>INFO</code>-level messages are logged.
You can also enable a &#8220;debug&#8221; mode by starting your application with a <code>--debug</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar myapp.jar --debug</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also specify <code>debug=true</code> in your <code>application.properties</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the debug mode is enabled, a selection of core loggers (embedded container, Hibernate, and Spring Boot) are configured to output more information.
Enabling the debug mode does <em>not</em> configure your application to log all messages with <code>DEBUG</code> level.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can enable a &#8220;trace&#8221; mode by starting your application with a <code>--trace</code> flag (or <code>trace=true</code> in your <code>application.properties</code>).
Doing so enables trace logging for a selection of core loggers (embedded container, Hibernate schema generation, and the whole Spring portfolio).</p>
</div>
<div class="sect3">
<h4 id="boot-features-logging-color-coded-output"><a class="anchor" href="#boot-features-logging-color-coded-output"></a>1.2.1. Color-coded Output</h4>
<div class="paragraph">
<p>If your terminal supports ANSI, color output is used to aid readability.
You can set <code>spring.output.ansi.enabled</code> to a <a href="https://docs.spring.io/spring-boot/docs/2.4.3/api/org/springframework/boot/ansi/AnsiOutput.Enabled.html">supported value</a> to override the auto-detection.</p>
</div>
<div class="paragraph">
<p>Color coding is configured by using the <code>%clr</code> conversion word.
In its simplest form, the converter colors the output according to the log level, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">%clr(%5p)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes the mapping of log levels to colors:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Level</th>
<th class="tableblock halign-left valign-top">Color</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FATAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WARN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yellow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Alternatively, you can specify the color or style that should be used by providing it as an option to the conversion.
For example, to make the text yellow, use the following setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){yellow}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following colors and styles are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>blue</code></p>
</li>
<li>
<p><code>cyan</code></p>
</li>
<li>
<p><code>faint</code></p>
</li>
<li>
<p><code>green</code></p>
</li>
<li>
<p><code>magenta</code></p>
</li>
<li>
<p><code>red</code></p>
</li>
<li>
<p><code>yellow</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-logging-file-output"><a class="anchor" href="#boot-features-logging-file-output"></a>1.3. File Output</h3>
<div class="paragraph">
<p>By default, Spring Boot logs only to the console and does not write log files.
If you want to write log files in addition to the console output, you need to set a <code>logging.file.name</code> or <code>logging.file.path</code> property (for example, in your <code>application.properties</code>).</p>
</div>
<div class="paragraph">
<p>The following table shows how the <code>logging.*</code> properties can be used together:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Logging properties</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>logging.file.name</code></th>
<th class="tableblock halign-left valign-top"><code>logging.file.path</code></th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(none)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(none)</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Console only logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(none)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes to the specified log file.
  Names can be an exact location or relative to the current directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(none)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes <code>spring.log</code> to the specified directory.
  Names can be an exact location or relative to the current directory.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Log files rotate when they reach 10 MB and, as with console output, <code>ERROR</code>-level, <code>WARN</code>-level, and <code>INFO</code>-level messages are logged by default.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Logging properties are independent of the actual logging infrastructure.
As a result, specific configuration keys (such as <code>logback.configurationFile</code> for Logback) are not managed by spring Boot.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-logging-file-rotation"><a class="anchor" href="#boot-features-logging-file-rotation"></a>1.4. File Rotation</h3>
<div class="paragraph">
<p>If you are using the Logback, it&#8217;s possible to fine-tune log rotation settings using your <code>application.properties</code> or <code>application.yaml</code> file.
For all other logging system, you&#8217;ll need to configure rotation settings directly yourself (for example, if you use Log4J2 then you could add a <code>log4j.xml</code> file).</p>
</div>
<div class="paragraph">
<p>The following rotation policy properties are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.file-name-pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The filename pattern used to create log archives.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.clean-history-on-start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If log archive cleanup should occur when the application starts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.max-file-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of log file before it&#8217;s archived.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.total-size-cap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of size log archives can take before being deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.max-history</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of days to keep log archives (defaults to 7)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="boot-features-custom-log-levels"><a class="anchor" href="#boot-features-custom-log-levels"></a>1.5. Log Levels</h3>
<div class="paragraph">
<p>All the supported logging systems can have the logger levels set in the Spring <code>Environment</code> (for example, in <code>application.properties</code>) by using <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code> where <code>level</code> is one of TRACE, DEBUG, INFO, WARN, ERROR, FATAL, or OFF.
The <code>root</code> logger can be configured by using <code>logging.level.root</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows potential logging settings in <code>application.properties</code>:</p>
</div>
<div class="listingblock primary">
<div class="title">Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">logging.level.root=warn
logging.level.org.springframework.web=debug
logging.level.org.hibernate=error</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">logging:
  level:
    root: "warn"
    org.springframework.web: "debug"
    org.hibernate: "error"</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to set logging levels using environment variables.
For example, <code>LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=DEBUG</code> will set <code>org.springframework.web</code> to <code>DEBUG</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above approach will only work for package level logging.
Since relaxed binding always converts environment variables to lowercase, it&#8217;s not possible to configure logging for an individual class in this way.
If you need to configure logging for a class, you can use <a href="#boot-features-external-config-application-json">the <code>SPRING_APPLICATION_JSON</code></a> variable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-custom-log-groups"><a class="anchor" href="#boot-features-custom-log-groups"></a>1.6. Log Groups</h3>
<div class="paragraph">
<p>It&#8217;s often useful to be able to group related loggers together so that they can all be configured at the same time.
For example, you might commonly change the logging levels for <em>all</em> Tomcat related loggers, but you can&#8217;t easily remember top level packages.</p>
</div>
<div class="paragraph">
<p>To help with this, Spring Boot allows you to define logging groups in your Spring <code>Environment</code>.
For example, here&#8217;s how you could define a &#8220;tomcat&#8221; group by adding it to your <code>application.properties</code>:</p>
</div>
<div class="listingblock primary">
<div class="title">Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">logging.group.tomcat=org.apache.catalina,org.apache.coyote,org.apache.tomcat</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">logging:
  group:
    tomcat: "org.apache.catalina,org.apache.coyote,org.apache.tomcat"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once defined, you can change the level for all the loggers in the group with a single line:</p>
</div>
<div class="listingblock primary">
<div class="title">Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">logging.level.tomcat=trace</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">logging:
  level:
    tomcat: "trace"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot includes the following pre-defined logging groups that can be used out-of-the-box:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Loggers</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code>, <code>org.springframework.boot.actuate.endpoint.web</code>, <code>org.springframework.boot.web.servlet.ServletContextInitializerBeans</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code>, <code>org.jooq.tools.LoggerListener</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="boot-features-log-shutdown-hook"><a class="anchor" href="#boot-features-log-shutdown-hook"></a>1.7. Using a Log Shutdown Hook</h3>
<div class="paragraph">
<p>In order to release logging resources when your application terminates, a shutdown hook that will trigger log system cleanup when the JVM exits is provided.
This shutdown hook is registered automatically unless your application is deployed as a war file.
If your application has complex context hierarchies the shutdown hook may not meet your needs.
If it does not, disable the shutdown hook and investigate the options provided directly by the underlying logging system.
For example, Logback offers <a href="http://logback.qos.ch/manual/loggingSeparation.html">context selectors</a> which allow each Logger to be created in its own context.
You can use the <code>logging.register-shutdown-hook</code> property to disable the shutdown hook.
Setting it to <code>false</code> will disable the registration.
You can set the property in your <code>application.properties</code> or <code>application.yaml</code> file:</p>
</div>
<div class="listingblock primary">
<div class="title">Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">logging.register-shutdown-hook=false</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">logging:
  register-shutdown-hook: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-custom-log-configuration"><a class="anchor" href="#boot-features-custom-log-configuration"></a>1.8. Custom Log Configuration</h3>
<div class="paragraph">
<p>The various logging systems can be activated by including the appropriate libraries on the classpath and can be further customized by providing a suitable configuration file in the root of the classpath or in a location specified by the following Spring <code>Environment</code> property: <code>logging.config</code>.</p>
</div>
<div class="paragraph">
<p>You can force Spring Boot to use a particular logging system by using the <code>org.springframework.boot.logging.LoggingSystem</code> system property.
The value should be the fully qualified class name of a <code>LoggingSystem</code> implementation.
You can also disable Spring Boot&#8217;s logging configuration entirely by using a value of <code>none</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since logging is initialized <strong>before</strong> the <code>ApplicationContext</code> is created, it is not possible to control logging from <code>@PropertySources</code> in Spring <code>@Configuration</code> files.
The only way to change the logging system or disable it entirely is via System properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on your logging system, the following files are loaded:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Logging System</th>
<th class="tableblock halign-left valign-top">Customization</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code>, or <code>logback.groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4j2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK (Java Util Logging)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.properties</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When possible, we recommend that you use the <code>-spring</code> variants for your logging configuration (for example, <code>logback-spring.xml</code> rather than <code>logback.xml</code>).
If you use standard configuration locations, Spring cannot completely control log initialization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
There are known classloading issues with Java Util Logging that cause problems when running from an 'executable jar'.
We recommend that you avoid it when running from an 'executable jar' if at all possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To help with the customization, some other properties are transferred from the Spring <code>Environment</code> to System properties, as described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring Environment</th>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.exception-conversion-word</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_EXCEPTION_CONVERSION_WORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The conversion word used when logging exceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.file.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_FILE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If defined, it is used in the default log configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.file.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_PATH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If defined, it is used in the default log configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.pattern.console</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSOLE_LOG_PATTERN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The log pattern to use on the console (stdout).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.pattern.dateformat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_DATEFORMAT_PATTERN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Appender pattern for log date format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.charset.console</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSOLE_LOG_CHARSET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The charset to use for console logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.pattern.file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FILE_LOG_PATTERN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The log pattern to use in a file (if <code>LOG_FILE</code> is enabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.charset.file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FILE_LOG_CHARSET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The charset to use for file logging (if <code>LOG_FILE</code> is enabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.pattern.level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_LEVEL_PATTERN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format to use when rendering the log level (default <code>%5p</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current process ID (discovered if possible and when not already defined as an OS environment variable).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you&#8217;re using Logback, the following properties are also transfered:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring Environment</th>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.file-name-pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOGBACK_ROLLINGPOLICY_FILE_NAME_PATTERN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pattern for rolled-over log file names (default <code>${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.clean-history-on-start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOGBACK_ROLLINGPOLICY_CLEAN_HISTORY_ON_START</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to clean the archive log files on startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.max-file-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOGBACK_ROLLINGPOLICY_MAX_FILE_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum log file size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.total-size-cap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOGBACK_ROLLINGPOLICY_TOTAL_SIZE_CAP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total size of log backups to be kept.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.logback.rollingpolicy.max-history</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOGBACK_ROLLINGPOLICY_MAX_HISTORY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of archive log files to keep.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All the supported logging systems can consult System properties when parsing their configuration files.
See the default configurations in <code>spring-boot.jar</code> for examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-projects/spring-boot/tree/{github-tag}/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml">Logback</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-boot/tree/{github-tag}/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml">Log4j 2</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-boot/tree/{github-tag}/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties">Java Util logging</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to use a placeholder in a logging property, you should use <a href="#boot-features-external-config-placeholders-in-properties">Spring Boot&#8217;s syntax</a> and not the syntax of the underlying framework.
Notably, if you use Logback, you should use <code>:</code> as the delimiter between a property name and its default value and not use <code>:-</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can add MDC and other ad-hoc content to log lines by overriding only the <code>LOG_LEVEL_PATTERN</code> (or <code>logging.pattern.level</code> with Logback).
For example, if you use <code>logging.pattern.level=user:%X{user} %5p</code>, then the default log format contains an MDC entry for "user", if it exists, as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2019-08-30 12:30:04.031 user:someone INFO 22174 --- [  nio-8080-exec-0] demo.Controller
Handling authenticated request</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-logback-extensions"><a class="anchor" href="#boot-features-logback-extensions"></a>1.9. Logback Extensions</h3>
<div class="paragraph">
<p>Spring Boot includes a number of extensions to Logback that can help with advanced configuration.
You can use these extensions in your <code>logback-spring.xml</code> configuration file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because the standard <code>logback.xml</code> configuration file is loaded too early, you cannot use extensions in it.
You need to either use <code>logback-spring.xml</code> or define a <code>logging.config</code> property.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The extensions cannot be used with Logback&#8217;s <a href="https://logback.qos.ch/manual/configuration.html#autoScan">configuration scanning</a>.
If you attempt to do so, making changes to the configuration file results in an error similar to one of the following being logged:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProperty], current ElementPath is [[configuration][springProperty]]
ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProfile], current ElementPath is [[configuration][springProfile]]</pre>
</div>
</div>
<div class="sect3">
<h4 id="profile-specific-configuration"><a class="anchor" href="#profile-specific-configuration"></a>1.9.1. Profile-specific Configuration</h4>
<div class="paragraph">
<p>The <code>&lt;springProfile&gt;</code> tag lets you optionally include or exclude sections of configuration based on the active Spring profiles.
Profile sections are supported anywhere within the <code>&lt;configuration&gt;</code> element.
Use the <code>name</code> attribute to specify which profile accepts the configuration.
The <code>&lt;springProfile&gt;</code> tag can contain a profile name (for example <code>staging</code>) or a profile expression.
A profile expression allows for more complicated profile logic to be expressed, for example <code>production &amp; (eu-central | eu-west)</code>.
Check the <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/core.html#beans-definition-profiles-java">reference guide</a> for more details.
The following listing shows three sample profiles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;springProfile name="staging"&gt;
    &lt;!-- configuration to be enabled when the "staging" profile is active --&gt;
&lt;/springProfile&gt;

&lt;springProfile name="dev | staging"&gt;
    &lt;!-- configuration to be enabled when the "dev" or "staging" profiles are active --&gt;
&lt;/springProfile&gt;

&lt;springProfile name="!production"&gt;
    &lt;!-- configuration to be enabled when the "production" profile is not active --&gt;
&lt;/springProfile&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="environment-properties"><a class="anchor" href="#environment-properties"></a>1.9.2. Environment Properties</h4>
<div class="paragraph">
<p>The <code>&lt;springProperty&gt;</code> tag lets you expose properties from the Spring <code>Environment</code> for use within Logback.
Doing so can be useful if you want to access values from your <code>application.properties</code> file in your Logback configuration.
The tag works in a similar way to Logback&#8217;s standard <code>&lt;property&gt;</code> tag.
However, rather than specifying a direct <code>value</code>, you specify the <code>source</code> of the property (from the <code>Environment</code>).
If you need to store the property somewhere other than in <code>local</code> scope, you can use the <code>scope</code> attribute.
If you need a fallback value (in case the property is not set in the <code>Environment</code>), you can use the <code>defaultValue</code> attribute.
The following example shows how to expose properties for use within Logback:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;springProperty scope="context" name="fluentHost" source="myapp.fluentd.host"
        defaultValue="localhost"/&gt;
&lt;appender name="FLUENT" class="ch.qos.logback.more.appenders.DataFluentAppender"&gt;
    &lt;remoteHost&gt;${fluentHost}&lt;/remoteHost&gt;
    ...
&lt;/appender&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>source</code> must be specified in kebab case (such as <code>my.property-name</code>).
However, properties can be added to the <code>Environment</code> by using the relaxed rules.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="boot-features-testing"><a class="anchor" href="#boot-features-testing"></a>2. Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot provides a number of utilities and annotations to help when testing your application.
Test support is provided by two modules: <code>spring-boot-test</code> contains core items, and <code>spring-boot-test-autoconfigure</code> supports auto-configuration for tests.</p>
</div>
<div class="paragraph">
<p>Most developers use the <code>spring-boot-starter-test</code> &#8220;Starter&#8221;, which imports both Spring Boot test modules as well as JUnit Jupiter, AssertJ, Hamcrest, and a number of other useful libraries.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have tests that use JUnit 4, JUnit 5&#8217;s vintage engine can be used to run them.
To use the vintage engine, add a dependency on <code>junit-vintage-engine</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
            &lt;artifactId&gt;hamcrest-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>hamcrest-core</code> is excluded in favor of <code>org.hamcrest:hamcrest</code> that is part of <code>spring-boot-starter-test</code>.</p>
</div>
<div class="sect2">
<h3 id="boot-features-test-scope-dependencies"><a class="anchor" href="#boot-features-test-scope-dependencies"></a>2.1. Test Scope Dependencies</h3>
<div class="paragraph">
<p>The <code>spring-boot-starter-test</code> &#8220;Starter&#8221; (in the <code>test</code> <code>scope</code>) contains the following provided libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://junit.org/junit5/">JUnit 5</a>: The de-facto standard for unit testing Java applications.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#integration-testing">Spring Test</a> &amp; Spring Boot Test: Utilities and integration test support for Spring Boot applications.</p>
</li>
<li>
<p><a href="https://assertj.github.io/doc/">AssertJ</a>: A fluent assertion library.</p>
</li>
<li>
<p><a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a>: A library of matcher objects (also known as constraints or predicates).</p>
</li>
<li>
<p><a href="https://site.mockito.org/">Mockito</a>: A Java mocking framework.</p>
</li>
<li>
<p><a href="https://github.com/skyscreamer/JSONassert">JSONassert</a>: An assertion library for JSON.</p>
</li>
<li>
<p><a href="https://github.com/jayway/JsonPath">JsonPath</a>: XPath for JSON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We generally find these common libraries to be useful when writing tests.
If these libraries do not suit your needs, you can add additional test dependencies of your own.</p>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-testing-spring-applications"><a class="anchor" href="#boot-features-testing-spring-applications"></a>2.2. Testing Spring Applications</h3>
<div class="paragraph">
<p>One of the major advantages of dependency injection is that it should make your code easier to unit test.
You can instantiate objects by using the <code>new</code> operator without even involving Spring.
You can also use <em>mock objects</em> instead of real dependencies.</p>
</div>
<div class="paragraph">
<p>Often, you need to move beyond unit testing and start integration testing (with a Spring <code>ApplicationContext</code>).
It is useful to be able to perform integration testing without requiring deployment of your application or needing to connect to other infrastructure.</p>
</div>
<div class="paragraph">
<p>The Spring Framework includes a dedicated test module for such integration testing.
You can declare a dependency directly to <code>org.springframework:spring-test</code> or use the <code>spring-boot-starter-test</code> &#8220;Starter&#8221; to pull it in transitively.</p>
</div>
<div class="paragraph">
<p>If you have not used the <code>spring-test</code> module before, you should start by reading the <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#testing">relevant section</a> of the Spring Framework reference documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-testing-spring-boot-applications"><a class="anchor" href="#boot-features-testing-spring-boot-applications"></a>2.3. Testing Spring Boot Applications</h3>
<div class="paragraph">
<p>A Spring Boot application is a Spring <code>ApplicationContext</code>, so nothing very special has to be done to test it beyond what you would normally do with a vanilla Spring context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
External properties, logging, and other features of Spring Boot are installed in the context by default only if you use <code>SpringApplication</code> to create it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring Boot provides a <code>@SpringBootTest</code> annotation, which can be used as an alternative to the standard <code>spring-test</code> <code>@ContextConfiguration</code> annotation when you need Spring Boot features.
The annotation works by <a href="#boot-features-testing-spring-boot-applications-detecting-config">creating the <code>ApplicationContext</code> used in your tests through <code>SpringApplication</code></a>.
In addition to <code>@SpringBootTest</code> a number of other annotations are also provided for <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">testing more specific slices</a> of an application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using JUnit 4, don&#8217;t forget to also add <code>@RunWith(SpringRunner.class)</code> to your test, otherwise the annotations will be ignored.
If you are using JUnit 5, there&#8217;s no need to add the equivalent <code>@ExtendWith(SpringExtension.class)</code> as <code>@SpringBootTest</code> and the other <code>@…Test</code> annotations are already annotated with it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>@SpringBootTest</code> will not start a server.
You can use the <code>webEnvironment</code> attribute of <code>@SpringBootTest</code> to further refine how your tests run:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MOCK</code>(Default) : Loads a web <code>ApplicationContext</code> and provides a mock web environment.
 Embedded servers are not started when using this annotation.
If a web environment is not available on your classpath, this mode transparently falls back to creating a regular non-web <code>ApplicationContext</code>.
It can be used in conjunction with <a href="#boot-features-testing-spring-boot-applications-testing-with-mock-environment"><code>@AutoConfigureMockMvc</code> or <code>@AutoConfigureWebTestClient</code></a> for mock-based testing of your web application.</p>
</li>
<li>
<p><code>RANDOM_PORT</code>: Loads a <code>WebServerApplicationContext</code> and provides a real web environment.
Embedded servers are started and listen on a random port.</p>
</li>
<li>
<p><code>DEFINED_PORT</code>: Loads a <code>WebServerApplicationContext</code> and provides a real web environment.
Embedded servers are started and listen on a defined port (from your <code>application.properties</code>) or on the default port of <code>8080</code>.</p>
</li>
<li>
<p><code>NONE</code>: Loads an <code>ApplicationContext</code> by using <code>SpringApplication</code> but does not provide <em>any</em> web environment (mock or otherwise).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your test is <code>@Transactional</code>, it rolls back the transaction at the end of each test method by default.
However, as using this arrangement with either <code>RANDOM_PORT</code> or <code>DEFINED_PORT</code> implicitly provides a real servlet environment, the HTTP client and server run in separate threads and, thus, in separate transactions.
Any transaction initiated on the server does not roll back in this case.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@SpringBootTest</code> with <code>webEnvironment = WebEnvironment.RANDOM_PORT</code> will also start the management server on a separate random port if your application uses a different port for the management server.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-detecting-web-app-type"><a class="anchor" href="#boot-features-testing-spring-boot-applications-detecting-web-app-type"></a>2.3.1. Detecting Web Application Type</h4>
<div class="paragraph">
<p>If Spring MVC is available, a regular MVC-based application context is configured.
If you have only Spring WebFlux, we&#8217;ll detect that and configure a WebFlux-based application context instead.</p>
</div>
<div class="paragraph">
<p>If both are present, Spring MVC takes precedence.
If you want to test a reactive web application in this scenario, you must set the <code>spring.main.web-application-type</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@SpringBootTest(properties = "spring.main.web-application-type=reactive")
class MyWebFluxTests { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-detecting-config"><a class="anchor" href="#boot-features-testing-spring-boot-applications-detecting-config"></a>2.3.2. Detecting Test Configuration</h4>
<div class="paragraph">
<p>If you are familiar with the Spring Test Framework, you may be used to using <code>@ContextConfiguration(classes=&#8230;&#8203;)</code> in order to specify which Spring <code>@Configuration</code> to load.
Alternatively, you might have often used nested <code>@Configuration</code> classes within your test.</p>
</div>
<div class="paragraph">
<p>When testing Spring Boot applications, this is often not required.
Spring Boot&#8217;s <code>@*Test</code> annotations search for your primary configuration automatically whenever you do not explicitly define one.</p>
</div>
<div class="paragraph">
<p>The search algorithm works up from the package that contains the test until it finds a class annotated with <code>@SpringBootApplication</code> or <code>@SpringBootConfiguration</code>.
As long as you <a href="using-spring-boot.html#using-boot-structuring-your-code">structured your code</a> in a sensible way, your main configuration is usually found.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use a <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">test annotation to test a more specific slice of your application</a>, you should avoid adding configuration settings that are specific to a particular area on the <a href="#boot-features-testing-spring-boot-applications-testing-user-configuration">main method&#8217;s application class</a>.</p>
</div>
<div class="paragraph">
<p>The underlying component scan configuration of <code>@SpringBootApplication</code> defines exclude filters that are used to make sure slicing works as expected.
If you are using an explicit <code>@ComponentScan</code> directive on your <code>@SpringBootApplication</code>-annotated class, be aware that those filters will be disabled.
If you are using slicing, you should define them again.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to customize the primary configuration, you can use a nested <code>@TestConfiguration</code> class.
Unlike a nested <code>@Configuration</code> class, which would be used instead of your application&#8217;s primary configuration, a nested <code>@TestConfiguration</code> class is used in addition to your application&#8217;s primary configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring&#8217;s test framework caches application contexts between tests.
Therefore, as long as your tests share the same configuration (no matter how it is discovered), the potentially time-consuming process of loading the context happens only once.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-excluding-config"><a class="anchor" href="#boot-features-testing-spring-boot-applications-excluding-config"></a>2.3.3. Excluding Test Configuration</h4>
<div class="paragraph">
<p>If your application uses component scanning (for example, if you use <code>@SpringBootApplication</code> or <code>@ComponentScan</code>), you may find top-level configuration classes that you created only for specific tests accidentally get picked up everywhere.</p>
</div>
<div class="paragraph">
<p>As we <a href="#boot-features-testing-spring-boot-applications-detecting-config">have seen earlier</a>, <code>@TestConfiguration</code> can be used on an inner class of a test to customize the primary configuration.
When placed on a top-level class, <code>@TestConfiguration</code> indicates that classes in <code>src/test/java</code> should not be picked up by scanning.
You can then import that class explicitly where it is required, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@SpringBootTest
@Import(MyTestsConfiguration.class)
class MyTests {

    @Test
    void exampleTest() {
        ...
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you directly use <code>@ComponentScan</code> (that is, not through <code>@SpringBootApplication</code>) you need to register the <code>TypeExcludeFilter</code> with it.
See <a href="https://docs.spring.io/spring-boot/docs/2.4.3/api/org/springframework/boot/context/TypeExcludeFilter.html">the Javadoc</a> for details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-application-arguments"><a class="anchor" href="#boot-features-testing-spring-boot-application-arguments"></a>2.3.4. Using Application Arguments</h4>
<div class="paragraph">
<p>If your application expects <a href="#boot-features-application-arguments">arguments</a>, you can
have <code>@SpringBootTest</code> inject them using the <code>args</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.test.context.SpringBootTest;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(args = "--app.test=one")
class ApplicationArgumentTests {

    @Test
    void applicationArgumentsPopulated(@Autowired ApplicationArguments args) {
        assertThat(args.getOptionNames()).containsOnly("app.test");
        assertThat(args.getOptionValues("app.test")).containsOnly("one");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-with-mock-environment"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-with-mock-environment"></a>2.3.5. Testing with a mock environment</h4>
<div class="paragraph">
<p>By default, <code>@SpringBootTest</code> does not start the server.
If you have web endpoints that you want to test against this mock environment, you can additionally configure <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#spring-mvc-test-framework"><code>MockMvc</code></a> as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@SpringBootTest
@AutoConfigureMockMvc
class MockMvcTests {

    @Test
    void exampleTest(@Autowired MockMvc mvc) throws Exception {
        mvc.perform(get("/")).andExpect(status().isOk()).andExpect(content().string("Hello World"));
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to focus only on the web layer and not start a complete <code>ApplicationContext</code>, consider <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests">using <code>@WebMvcTest</code> instead</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can configure a <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#webtestclient-tests"><code>WebTestClient</code></a> as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.web.reactive.server.WebTestClient;

@SpringBootTest
@AutoConfigureWebTestClient
class MockWebTestClientTests {

    @Test
    void exampleTest(@Autowired WebTestClient webClient) {
        webClient.get().uri("/").exchange().expectStatus().isOk().expectBody(String.class).isEqualTo("Hello World");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Testing within a mocked environment is usually faster than running with a full Servlet container.
However, since mocking occurs at the Spring MVC layer, code that relies on lower-level Servlet container behavior cannot be directly tested with MockMvc.</p>
</div>
<div class="paragraph">
<p>For example, Spring Boot&#8217;s error handling is based on the &#8220;error page&#8221; support provided by the Servlet container.
This means that, whilst you can test your MVC layer throws and handles exceptions as expected, you cannot directly test that a specific <a href="#boot-features-error-handling-custom-error-pages">custom error page</a> is rendered.
If you need to test these lower-level concerns, you can start a fully running server as described in the next section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-with-running-server"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-with-running-server"></a>2.3.6. Testing with a running server</h4>
<div class="paragraph">
<p>If you need to start a full running server, we recommend that you use random ports.
If you use <code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>, an available port is picked at random each time your test runs.</p>
</div>
<div class="paragraph">
<p>The <code>@LocalServerPort</code> annotation can be used to <a href="howto.html#howto-discover-the-http-port-at-runtime">inject the actual port used</a> into your test.
For convenience, tests that need to make REST calls to the started server can additionally <code>@Autowire</code> a <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#webtestclient-tests"><code>WebTestClient</code></a>, which resolves relative links to the running server and comes with a dedicated API for verifying responses, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.test.web.reactive.server.WebTestClient;

@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
class RandomPortWebTestClientTests {

    @Test
    void exampleTest(@Autowired WebTestClient webClient) {
        webClient.get().uri("/").exchange().expectStatus().isOk().expectBody(String.class).isEqualTo("Hello World");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup requires <code>spring-webflux</code> on the classpath.
If you can&#8217;t or won&#8217;t add webflux, Spring Boot also provides a <code>TestRestTemplate</code> facility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.boot.test.web.client.TestRestTemplate;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
class RandomPortTestRestTemplateTests {

    @Test
    void exampleTest(@Autowired TestRestTemplate restTemplate) {
        String body = restTemplate.getForObject("/", String.class);
        assertThat(body).isEqualTo("Hello World");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-customizing-web-test-client"><a class="anchor" href="#boot-features-testing-spring-boot-applications-customizing-web-test-client"></a>2.3.7. Customizing WebTestClient</h4>
<div class="paragraph">
<p>To customize the <code>WebTestClient</code> bean, configure a <code>WebTestClientBuilderCustomizer</code> bean.
Any such beans are called with the <code>WebTestClient.Builder</code> that is used to create the <code>WebTestClient</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-jmx"><a class="anchor" href="#boot-features-testing-spring-boot-applications-jmx"></a>2.3.8. Using JMX</h4>
<div class="paragraph">
<p>As the test context framework caches context, JMX is disabled by default to prevent identical components to register on the same domain.
If such test needs access to an <code>MBeanServer</code>, consider marking it dirty as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing.jmx;

import javax.management.MBeanServer;
import javax.management.MalformedObjectNameException;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.DirtiesContext;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import static org.assertj.core.api.Assertions.assertThat;

@ExtendWith(SpringExtension.class)
@SpringBootTest(properties = "spring.jmx.enabled=true")
@DirtiesContext
class SampleJmxTests {

    @Autowired
    private MBeanServer mBeanServer;

    @Test
    void exampleTest() throws MalformedObjectNameException {
        assertThat(this.mBeanServer.getDomains()).contains("java.lang");
        // ...
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-metrics"><a class="anchor" href="#boot-features-testing-spring-boot-applications-metrics"></a>2.3.9. Using Metrics</h4>
<div class="paragraph">
<p>Regardless of your classpath, meter registries, except the in-memory backed, are not auto-configured when using <code>@SpringBootTest</code>.</p>
</div>
<div class="paragraph">
<p>If you need to export metrics to a different backend as part of an integration test, annotate it with <code>@AutoConfigureMetrics</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-mocking-beans"><a class="anchor" href="#boot-features-testing-spring-boot-applications-mocking-beans"></a>2.3.10. Mocking and Spying Beans</h4>
<div class="paragraph">
<p>When running tests, it is sometimes necessary to mock certain components within your application context.
For example, you may have a facade over some remote service that is unavailable during development.
Mocking can also be useful when you want to simulate failures that might be hard to trigger in a real environment.</p>
</div>
<div class="paragraph">
<p>Spring Boot includes a <code>@MockBean</code> annotation that can be used to define a Mockito mock for a bean inside your <code>ApplicationContext</code>.
You can use the annotation to add new beans or replace a single existing bean definition.
The annotation can be used directly on test classes, on fields within your test, or on <code>@Configuration</code> classes and fields.
When used on a field, the instance of the created mock is also injected.
Mock beans are automatically reset after each test method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your test uses one of Spring Boot&#8217;s test annotations (such as <code>@SpringBootTest</code>), this feature is automatically enabled.
To use this feature with a different arrangement, listeners must be explicitly added, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@TestExecutionListeners({ MockitoTestExecutionListener.class, ResetMocksTestExecutionListener.class })</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example replaces an existing <code>RemoteService</code> bean with a mock implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.*;
import org.springframework.boot.test.context.*;
import org.springframework.boot.test.mock.mockito.*;

import static org.assertj.core.api.Assertions.*;
import static org.mockito.BDDMockito.*;

@SpringBootTest
class MyTests {

    @MockBean
    private RemoteService remoteService;

    @Autowired
    private Reverser reverser;

    @Test
    void exampleTest() {
        // RemoteService has been injected into the reverser bean
        given(this.remoteService.someCall()).willReturn("mock");
        String reverse = reverser.reverseSomeCall();
        assertThat(reverse).isEqualTo("kcom");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@MockBean</code> cannot be used to mock the behavior of a bean that&#8217;s exercised during application context refresh.
By the time the test is executed, the application context refresh has completed and it is too late to configure the mocked behavior.
We recommend using a <code>@Bean</code> method to create and configure the mock in this situation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, you can use <code>@SpyBean</code> to wrap any existing bean with a Mockito <code>spy</code>.
See the <a href="https://docs.spring.io/spring-boot/docs/2.4.3/api/org/springframework/boot/test/mock/mockito/SpyBean.html">Javadoc</a> for full details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
CGLib proxies, such as those created for scoped beans, declare the proxied methods as <code>final</code>.
This stops Mockito from functioning correctly as it cannot mock or spy on <code>final</code> methods in its default configuration.
If you want to mock or spy on such a bean, configure Mockito to use its inline mock maker by adding <code>org.mockito:mockito-inline</code> to your application&#8217;s test dependencies.
This allows Mockito to mock and spy on <code>final</code> methods.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While Spring&#8217;s test framework caches application contexts between tests and reuses a context for tests sharing the same configuration, the use of <code>@MockBean</code> or <code>@SpyBean</code> influences the cache key, which will most likely increase the number of contexts.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using <code>@SpyBean</code> to spy on a bean with <code>@Cacheable</code> methods that refer to parameters by name, your application must be compiled with <code>-parameters</code>.
This ensures that the parameter names are available to the caching infrastructure once the bean has been spied upon.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When you are using <code>@SpyBean</code> to spy on a bean that is proxied by Spring, you may need to remove Spring&#8217;s proxy in some situations, for example when setting expectations using <code>given</code> or <code>when</code>.
Use <code>AopTestUtils.getTargetObject(yourProxiedSpy)</code> to do so.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-tests"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests"></a>2.3.11. Auto-configured Tests</h4>
<div class="paragraph">
<p>Spring Boot&#8217;s auto-configuration system works well for applications but can sometimes be a little too much for tests.
It often helps to load only the parts of the configuration that are required to test a &#8220;slice&#8221; of your application.
For example, you might want to test that Spring MVC controllers are mapping URLs correctly, and you do not want to involve database calls in those tests, or you might want to test JPA entities, and you are not interested in the web layer when those tests run.</p>
</div>
<div class="paragraph">
<p>The <code>spring-boot-test-autoconfigure</code> module includes a number of annotations that can be used to automatically configure such &#8220;slices&#8221;.
Each of them works in a similar way, providing a <code>@&#8230;&#8203;Test</code> annotation that loads the <code>ApplicationContext</code> and one or more <code>@AutoConfigure&#8230;&#8203;</code> annotations that can be used to customize auto-configuration settings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each slice restricts component scan to appropriate components and loads a very restricted set of auto-configuration classes.
If you need to exclude one of them, most <code>@&#8230;&#8203;Test</code> annotations provide an <code>excludeAutoConfiguration</code> attribute.
Alternatively, you can use <code>@ImportAutoConfiguration#exclude</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Including multiple &#8220;slices&#8221; by using several <code>@&#8230;&#8203;Test</code> annotations in one test is not supported.
If you need multiple &#8220;slices&#8221;, pick one of the <code>@&#8230;&#8203;Test</code> annotations and include the <code>@AutoConfigure&#8230;&#8203;</code> annotations of the other &#8220;slices&#8221; by hand.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is also possible to use the <code>@AutoConfigure&#8230;&#8203;</code> annotations with the standard <code>@SpringBootTest</code> annotation.
You can use this combination if you are not interested in &#8220;slicing&#8221; your application but you want some of the auto-configured test beans.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-json-tests"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-json-tests"></a>2.3.12. Auto-configured JSON Tests</h4>
<div class="paragraph">
<p>To test that object JSON serialization and deserialization is working as expected, you can use the <code>@JsonTest</code> annotation.
<code>@JsonTest</code> auto-configures the available supported JSON mapper, which can be one of the following libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jackson <code>ObjectMapper</code>, any <code>@JsonComponent</code> beans and any Jackson <code>Module</code>s</p>
</li>
<li>
<p><code>Gson</code></p>
</li>
<li>
<p><code>Jsonb</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configurations that are enabled by <code>@JsonTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to configure elements of the auto-configuration, you can use the <code>@AutoConfigureJsonTesters</code> annotation.</p>
</div>
<div class="paragraph">
<p>Spring Boot includes AssertJ-based helpers that work with the JSONAssert and JsonPath libraries to check that JSON appears as expected.
The <code>JacksonTester</code>, <code>GsonTester</code>, <code>JsonbTester</code>, and <code>BasicJsonTester</code> classes can be used for Jackson, Gson, Jsonb, and Strings respectively.
Any helper fields on the test class can be <code>@Autowired</code> when using <code>@JsonTest</code>.
The following example shows a test class for Jackson:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.*;
import org.springframework.boot.test.autoconfigure.json.*;
import org.springframework.boot.test.context.*;
import org.springframework.boot.test.json.*;

import static org.assertj.core.api.Assertions.*;

@JsonTest
class MyJsonTests {

    @Autowired
    private JacksonTester&lt;VehicleDetails&gt; json;

    @Test
    void testSerialize() throws Exception {
        VehicleDetails details = new VehicleDetails("Honda", "Civic");
        // Assert against a `.json` file in the same package as the test
        assertThat(this.json.write(details)).isEqualToJson("expected.json");
        // Or use JSON path based assertions
        assertThat(this.json.write(details)).hasJsonPathStringValue("@.make");
        assertThat(this.json.write(details)).extractingJsonPathStringValue("@.make")
                .isEqualTo("Honda");
    }

    @Test
    void testDeserialize() throws Exception {
        String content = "{\"make\":\"Ford\",\"model\":\"Focus\"}";
        assertThat(this.json.parse(content))
                .isEqualTo(new VehicleDetails("Ford", "Focus"));
        assertThat(this.json.parseObject(content).getMake()).isEqualTo("Ford");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JSON helper classes can also be used directly in standard unit tests.
To do so, call the <code>initFields</code> method of the helper in your <code>@Before</code> method if you do not use <code>@JsonTest</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you&#8217;re using Spring Boot&#8217;s AssertJ-based helpers to assert on a number value at a given JSON path, you might not be able to use <code>isEqualTo</code> depending on the type.
Instead, you can use AssertJ&#8217;s <code>satisfies</code> to assert that the value matches the given condition.
For instance, the following example asserts that the actual number is a float value close to <code>0.15</code> within an offset of <code>0.01</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">assertThat(json.write(message))
    .extractingJsonPathNumberValue("@.test.numberValue")
    .satisfies((number) -&gt; assertThat(number.floatValue()).isCloseTo(0.15f, within(0.01f)));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests"></a>2.3.13. Auto-configured Spring MVC Tests</h4>
<div class="paragraph">
<p>To test whether Spring MVC controllers are working as expected, use the <code>@WebMvcTest</code> annotation.
<code>@WebMvcTest</code> auto-configures the Spring MVC infrastructure and limits scanned beans to <code>@Controller</code>, <code>@ControllerAdvice</code>, <code>@JsonComponent</code>, <code>Converter</code>, <code>GenericConverter</code>, <code>Filter</code>, <code>HandlerInterceptor</code>, <code>WebMvcConfigurer</code>, and <code>HandlerMethodArgumentResolver</code>.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@WebMvcTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@WebMvcTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to register extra components, such as the Jackson <code>Module</code>, you can import additional configuration classes by using <code>@Import</code> on your test.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Often, <code>@WebMvcTest</code> is limited to a single controller and is used in combination with <code>@MockBean</code> to provide mock implementations for required collaborators.</p>
</div>
<div class="paragraph">
<p><code>@WebMvcTest</code> also auto-configures <code>MockMvc</code>.
Mock MVC offers a powerful way to quickly test MVC controllers without needing to start a full HTTP server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also auto-configure <code>MockMvc</code> in a non-<code>@WebMvcTest</code> (such as <code>@SpringBootTest</code>) by annotating it with <code>@AutoConfigureMockMvc</code>.
The following example uses <code>MockMvc</code>:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.*;
import org.springframework.beans.factory.annotation.*;
import org.springframework.boot.test.autoconfigure.web.servlet.*;
import org.springframework.boot.test.mock.mockito.*;

import static org.assertj.core.api.Assertions.*;
import static org.mockito.BDDMockito.*;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(UserVehicleController.class)
class MyControllerTests {

    @Autowired
    private MockMvc mvc;

    @MockBean
    private UserVehicleService userVehicleService;

    @Test
    void testExample() throws Exception {
        given(this.userVehicleService.getVehicleDetails("sboot"))
                .willReturn(new VehicleDetails("Honda", "Civic"));
        this.mvc.perform(get("/sboot/vehicle").accept(MediaType.TEXT_PLAIN))
                .andExpect(status().isOk()).andExpect(content().string("Honda Civic"));
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to configure elements of the auto-configuration (for example, when servlet filters should be applied) you can use attributes in the <code>@AutoConfigureMockMvc</code> annotation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use HtmlUnit or Selenium, auto-configuration also provides an HtmlUnit <code>WebClient</code> bean and/or a Selenium <code>WebDriver</code> bean.
The following example uses HtmlUnit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import com.gargoylesoftware.htmlunit.*;
import org.junit.jupiter.api.*;
import org.springframework.beans.factory.annotation.*;
import org.springframework.boot.test.autoconfigure.web.servlet.*;
import org.springframework.boot.test.mock.mockito.*;

import static org.assertj.core.api.Assertions.*;
import static org.mockito.BDDMockito.*;

@WebMvcTest(UserVehicleController.class)
class MyHtmlUnitTests {

    @Autowired
    private WebClient webClient;

    @MockBean
    private UserVehicleService userVehicleService;

    @Test
    void testExample() throws Exception {
        given(this.userVehicleService.getVehicleDetails("sboot"))
                .willReturn(new VehicleDetails("Honda", "Civic"));
        HtmlPage page = this.webClient.getPage("/sboot/vehicle.html");
        assertThat(page.getBody().getTextContent()).isEqualTo("Honda Civic");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Spring Boot puts <code>WebDriver</code> beans in a special &#8220;scope&#8221; to ensure that the driver exits after each test and that a new instance is injected.
If you do not want this behavior, you can add <code>@Scope("singleton")</code> to your <code>WebDriver</code> <code>@Bean</code> definition.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>webDriver</code> scope created by Spring Boot will replace any user defined scope of the same name.
If you define your own <code>webDriver</code> scope you may find it stops working when you use <code>@WebMvcTest</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have Spring Security on the classpath, <code>@WebMvcTest</code> will also scan <code>WebSecurityConfigurer</code> beans.
Instead of disabling security completely for such tests, you can use Spring Security&#8217;s test support.
More details on how to use Spring Security&#8217;s <code>MockMvc</code> support can be found in this <em><a href="howto.html#howto-use-test-with-spring-security">howto.html</a></em> how-to section.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Sometimes writing Spring MVC tests is not enough; Spring Boot can help you run <a href="#boot-features-testing-spring-boot-applications-testing-with-running-server">full end-to-end tests with an actual server</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests"></a>2.3.14. Auto-configured Spring WebFlux Tests</h4>
<div class="paragraph">
<p>To test that <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/web-reactive.html">Spring WebFlux</a> controllers are working as expected, you can use the <code>@WebFluxTest</code> annotation.
<code>@WebFluxTest</code> auto-configures the Spring WebFlux infrastructure and limits scanned beans to <code>@Controller</code>, <code>@ControllerAdvice</code>, <code>@JsonComponent</code>, <code>Converter</code>, <code>GenericConverter</code>, <code>WebFilter</code>, and <code>WebFluxConfigurer</code>.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@WebFluxTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configurations that are enabled by <code>@WebFluxTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to register extra components, such as Jackson <code>Module</code>, you can import additional configuration classes using <code>@Import</code> on your test.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Often, <code>@WebFluxTest</code> is limited to a single controller and used in combination with the <code>@MockBean</code> annotation to provide mock implementations for required collaborators.</p>
</div>
<div class="paragraph">
<p><code>@WebFluxTest</code> also auto-configures <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#webtestclient"><code>WebTestClient</code></a>, which offers a powerful way to quickly test WebFlux controllers without needing to start a full HTTP server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also auto-configure <code>WebTestClient</code> in a non-<code>@WebFluxTest</code> (such as <code>@SpringBootTest</code>) by annotating it with <code>@AutoConfigureWebTestClient</code>.
The following example shows a class that uses both <code>@WebFluxTest</code> and a <code>WebTestClient</code>:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.reactive.server.WebTestClient;

@WebFluxTest(UserVehicleController.class)
class MyControllerTests {

    @Autowired
    private WebTestClient webClient;

    @MockBean
    private UserVehicleService userVehicleService;

    @Test
    void testExample() throws Exception {
        given(this.userVehicleService.getVehicleDetails("sboot"))
                .willReturn(new VehicleDetails("Honda", "Civic"));
        this.webClient.get().uri("/sboot/vehicle").accept(MediaType.TEXT_PLAIN)
                .exchange()
                .expectStatus().isOk()
                .expectBody(String.class).isEqualTo("Honda Civic");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This setup is only supported by WebFlux applications as using <code>WebTestClient</code> in a mocked web application only works with WebFlux at the moment.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@WebFluxTest</code> cannot detect routes registered via the functional web framework.
For testing <code>RouterFunction</code> beans in the context, consider importing your <code>RouterFunction</code> yourself via <code>@Import</code> or using <code>@SpringBootTest</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@WebFluxTest</code> cannot detect custom security configuration registered via a <code>@Bean</code> of type <code>SecurityWebFilterChain</code>.
To include that in your test, you will need to import the configuration that registers the bean via <code>@Import</code> or use <code>@SpringBootTest</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Sometimes writing Spring WebFlux tests is not enough; Spring Boot can help you run <a href="#boot-features-testing-spring-boot-applications-testing-with-running-server">full end-to-end tests with an actual server</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-cassandra-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-cassandra-test"></a>2.3.15. Auto-configured Data Cassandra Tests</h4>
<div class="paragraph">
<p>You can use <code>@DataCassandraTest</code> to test Cassandra applications.
By default, it configures a <code>CassandraTemplate</code>, scans for <code>@Table</code> classes, and configures Spring Data Cassandra repositories.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataCassandraTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.
(For more about using Cassandra with Spring Boot, see "<a href="#boot-features-cassandra">[boot-features-cassandra]</a>", earlier in this chapter.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@DataCassandraTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows a typical setup for using Cassandra tests in Spring Boot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.cassandra.DataCassandraTest;

@DataCassandraTest
class ExampleDataCassandraTests {

    @Autowired
    private YourRepository repository;

    //
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test"></a>2.3.16. Auto-configured Data JPA Tests</h4>
<div class="paragraph">
<p>You can use the <code>@DataJpaTest</code> annotation to test JPA applications.
By default, it scans for <code>@Entity</code> classes and configures Spring Data JPA repositories.
If an embedded database is available on the classpath, it configures one as well.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataJpaTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@DataJpaTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, data JPA tests are transactional and roll back at the end of each test.
See the <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#testcontext-tx-enabling-transactions">relevant section</a> in the Spring Framework Reference Documentation for more details.
If that is not what you want, you can disable transaction management for a test or for the whole class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

@DataJpaTest
@Transactional(propagation = Propagation.NOT_SUPPORTED)
class ExampleNonTransactionalTests {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Data JPA tests may also inject a <a href="https://github.com/spring-projects/spring-boot/tree/{github-tag}/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.java"><code>TestEntityManager</code></a> bean, which provides an alternative to the standard JPA <code>EntityManager</code> that is specifically designed for tests.
If you want to use <code>TestEntityManager</code> outside of <code>@DataJpaTest</code> instances, you can also use the <code>@AutoConfigureTestEntityManager</code> annotation.
A <code>JdbcTemplate</code> is also available if you need that.
The following example shows the <code>@DataJpaTest</code> annotation in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;
import org.springframework.boot.test.autoconfigure.orm.jpa.*;

import static org.assertj.core.api.Assertions.*;

@DataJpaTest
class ExampleRepositoryTests {

    @Autowired
    private TestEntityManager entityManager;

    @Autowired
    private UserRepository repository;

    @Test
    void testExample() throws Exception {
        this.entityManager.persist(new User("sboot", "1234"));
        User user = this.repository.findByUsername("sboot");
        assertThat(user.getUsername()).isEqualTo("sboot");
        assertThat(user.getVin()).isEqualTo("1234");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In-memory embedded databases generally work well for tests, since they are fast and do not require any installation.
If, however, you prefer to run tests against a real database you can use the <code>@AutoConfigureTestDatabase</code> annotation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@DataJpaTest
@AutoConfigureTestDatabase(replace=Replace.NONE)
class ExampleRepositoryTests {

    // ...

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test"></a>2.3.17. Auto-configured JDBC Tests</h4>
<div class="paragraph">
<p><code>@JdbcTest</code> is similar to <code>@DataJpaTest</code> but is for tests that only require a <code>DataSource</code> and do not use Spring Data JDBC.
By default, it configures an in-memory embedded database and a <code>JdbcTemplate</code>.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@JdbcTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configurations that are enabled by <code>@JdbcTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, JDBC tests are transactional and roll back at the end of each test.
See the <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#testcontext-tx-enabling-transactions">relevant section</a> in the Spring Framework Reference Documentation for more details.
If that is not what you want, you can disable transaction management for a test or for the whole class, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;
import org.springframework.boot.test.autoconfigure.jdbc.JdbcTest;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

@JdbcTest
@Transactional(propagation = Propagation.NOT_SUPPORTED)
class ExampleNonTransactionalTests {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer your test to run against a real database, you can use the <code>@AutoConfigureTestDatabase</code> annotation in the same way as for <code>DataJpaTest</code>.
(See "<a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">Auto-configured Data JPA Tests</a>".)</p>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-data-jdbc-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-data-jdbc-test"></a>2.3.18. Auto-configured Data JDBC Tests</h4>
<div class="paragraph">
<p><code>@DataJdbcTest</code> is similar to <code>@JdbcTest</code> but is for tests that use Spring Data JDBC repositories.
By default, it configures an in-memory embedded database, a <code>JdbcTemplate</code>, and Spring Data JDBC repositories.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataJdbcTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configurations that are enabled by <code>@DataJdbcTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Data JDBC tests are transactional and roll back at the end of each test.
See the <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#testcontext-tx-enabling-transactions">relevant section</a> in the Spring Framework Reference Documentation for more details.
If that is not what you want, you can disable transaction management for a test or for the whole test class as <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test">shown in the JDBC example</a>.</p>
</div>
<div class="paragraph">
<p>If you prefer your test to run against a real database, you can use the <code>@AutoConfigureTestDatabase</code> annotation in the same way as for <code>DataJpaTest</code>.
(See "<a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">Auto-configured Data JPA Tests</a>".)</p>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-jooq-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jooq-test"></a>2.3.19. Auto-configured jOOQ Tests</h4>
<div class="paragraph">
<p>You can use <code>@JooqTest</code> in a similar fashion as <code>@JdbcTest</code> but for jOOQ-related tests.
As jOOQ relies heavily on a Java-based schema that corresponds with the database schema, the existing <code>DataSource</code> is used.
If you want to replace it with an in-memory database, you can use <code>@AutoConfigureTestDatabase</code> to override those settings.
(For more about using jOOQ with Spring Boot, see "<a href="#boot-features-jooq">[boot-features-jooq]</a>", earlier in this chapter.)
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@JooqTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configurations that are enabled by <code>@JooqTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@JooqTest</code> configures a <code>DSLContext</code>.
The following example shows the <code>@JooqTest</code> annotation in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.jooq.DSLContext;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.autoconfigure.jooq.JooqTest;

@JooqTest
class ExampleJooqTests {

    @Autowired
    private DSLContext dslContext;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JOOQ tests are transactional and roll back at the end of each test by default.
If that is not what you want, you can disable transaction management for a test or for the whole test class as <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test">shown in the JDBC example</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-mongo-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mongo-test"></a>2.3.20. Auto-configured Data MongoDB Tests</h4>
<div class="paragraph">
<p>You can use <code>@DataMongoTest</code> to test MongoDB applications.
By default, it configures an in-memory embedded MongoDB (if available), configures a <code>MongoTemplate</code>, scans for <code>@Document</code> classes, and configures Spring Data MongoDB repositories.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataMongoTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.
(For more about using MongoDB with Spring Boot, see "<a href="#boot-features-mongodb">[boot-features-mongodb]</a>", earlier in this chapter.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@DataMongoTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following class shows the <code>@DataMongoTest</code> annotation in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;
import org.springframework.data.mongodb.core.MongoTemplate;

@DataMongoTest
class ExampleDataMongoTests {

    @Autowired
    private MongoTemplate mongoTemplate;

    //
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In-memory embedded MongoDB generally works well for tests, since it is fast and does not require any developer installation.
If, however, you prefer to run tests against a real MongoDB server, you should exclude the embedded MongoDB auto-configuration, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration;
import org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;

@DataMongoTest(excludeAutoConfiguration = EmbeddedMongoAutoConfiguration.class)
class ExampleDataMongoNonEmbeddedTests {

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test"></a>2.3.21. Auto-configured Data Neo4j Tests</h4>
<div class="paragraph">
<p>You can use <code>@DataNeo4jTest</code> to test Neo4j applications.
By default, it scans for <code>@Node</code> classes, and configures Spring Data Neo4j repositories.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataNeo4jTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.
(For more about using Neo4J with Spring Boot, see "<a href="#boot-features-neo4j">[boot-features-neo4j]</a>", earlier in this chapter.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@DataNeo4jTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows a typical setup for using Neo4J tests in Spring Boot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;

@DataNeo4jTest
class ExampleDataNeo4jTests {

    @Autowired
    private YourRepository repository;

    //
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, Data Neo4j tests are transactional and roll back at the end of each test.
See the <a href="https://docs.spring.io/spring/docs/5.3.4/reference/html/testing.html#testcontext-tx-enabling-transactions">relevant section</a> in the Spring Framework Reference Documentation for more details.
If that is not what you want, you can disable transaction management for a test or for the whole class, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

@DataNeo4jTest
@Transactional(propagation = Propagation.NOT_SUPPORTED)
class ExampleNonTransactionalTests {

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Transactional tests are not supported with reactive access.
If you are using this style, you must configure <code>@DataNeo4jTest</code> tests as described above.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-redis-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-redis-test"></a>2.3.22. Auto-configured Data Redis Tests</h4>
<div class="paragraph">
<p>You can use <code>@DataRedisTest</code> to test Redis applications.
By default, it scans for <code>@RedisHash</code> classes and configures Spring Data Redis repositories.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataRedisTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.
(For more about using Redis with Spring Boot, see "<a href="#boot-features-redis">[boot-features-redis]</a>", earlier in this chapter.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@DataRedisTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows the <code>@DataRedisTest</code> annotation in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.redis.DataRedisTest;

@DataRedisTest
class ExampleDataRedisTests {

    @Autowired
    private YourRepository repository;

    //
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-ldap-test"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-ldap-test"></a>2.3.23. Auto-configured Data LDAP Tests</h4>
<div class="paragraph">
<p>You can use <code>@DataLdapTest</code> to test LDAP applications.
By default, it configures an in-memory embedded LDAP (if available), configures an <code>LdapTemplate</code>, scans for <code>@Entry</code> classes, and configures Spring Data LDAP repositories.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@DataLdapTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.
(For more about using LDAP with Spring Boot, see "<a href="#boot-features-ldap">[boot-features-ldap]</a>", earlier in this chapter.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@DataLdapTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows the <code>@DataLdapTest</code> annotation in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;
import org.springframework.ldap.core.LdapTemplate;

@DataLdapTest
class ExampleDataLdapTests {

    @Autowired
    private LdapTemplate ldapTemplate;

    //
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In-memory embedded LDAP generally works well for tests, since it is fast and does not require any developer installation.
If, however, you prefer to run tests against a real LDAP server, you should exclude the embedded LDAP auto-configuration, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration;
import org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;

@DataLdapTest(excludeAutoConfiguration = EmbeddedLdapAutoConfiguration.class)
class ExampleDataLdapNonEmbeddedTests {

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-client"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-client"></a>2.3.24. Auto-configured REST Clients</h4>
<div class="paragraph">
<p>You can use the <code>@RestClientTest</code> annotation to test REST clients.
By default, it auto-configures Jackson, GSON, and Jsonb support, configures a <code>RestTemplateBuilder</code>, and adds support for <code>MockRestServiceServer</code>.
Regular <code>@Component</code> and <code>@ConfigurationProperties</code> beans are not scanned when the <code>@RestClientTest</code> annotation is used.
<code>@EnableConfigurationProperties</code> can be used to include <code>@ConfigurationProperties</code> beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@RestClientTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The specific beans that you want to test should be specified by using the <code>value</code> or <code>components</code> attribute of <code>@RestClientTest</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@RestClientTest(RemoteVehicleDetailsService.class)
class ExampleRestClientTest {

    @Autowired
    private RemoteVehicleDetailsService service;

    @Autowired
    private MockRestServiceServer server;

    @Test
    void getVehicleDetailsWhenResultIsSuccessShouldReturnDetails()
            throws Exception {
        this.server.expect(requestTo("/greet/details"))
                .andRespond(withSuccess("hello", MediaType.TEXT_PLAIN));
        String greeting = this.service.callRestService();
        assertThat(greeting).isEqualTo("hello");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs"></a>2.3.25. Auto-configured Spring REST Docs Tests</h4>
<div class="paragraph">
<p>You can use the <code>@AutoConfigureRestDocs</code> annotation to use <a href="https://spring.io/projects/spring-restdocs">Spring REST Docs</a> in your tests with Mock MVC, REST Assured, or WebTestClient.
It removes the need for the JUnit extension in Spring REST Docs.</p>
</div>
<div class="paragraph">
<p><code>@AutoConfigureRestDocs</code> can be used to override the default output directory (<code>target/generated-snippets</code> if you are using Maven or <code>build/generated-snippets</code> if you are using Gradle).
It can also be used to configure the host, scheme, and port that appears in any documented URIs.</p>
</div>
<div class="sect4">
<h5 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-mock-mvc"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-mock-mvc"></a>Auto-configured Spring REST Docs Tests with Mock MVC</h5>
<div class="paragraph">
<p><code>@AutoConfigureRestDocs</code> customizes the <code>MockMvc</code> bean to use Spring REST Docs when testing Servlet-based web applications.
You can inject it by using <code>@Autowired</code> and use it in your tests as you normally would when using Mock MVC and Spring REST Docs, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(UserController.class)
@AutoConfigureRestDocs
class UserDocumentationTests {

    @Autowired
    private MockMvc mvc;

    @Test
    void listUsers() throws Exception {
        this.mvc.perform(get("/users").accept(MediaType.TEXT_PLAIN))
                .andExpect(status().isOk())
                .andDo(document("list-users"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you require more control over Spring REST Docs configuration than offered by the attributes of <code>@AutoConfigureRestDocs</code>, you can use a <code>RestDocsMockMvcConfigurationCustomizer</code> bean, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@TestConfiguration
static class CustomizationConfiguration
        implements RestDocsMockMvcConfigurationCustomizer {

    @Override
    public void customize(MockMvcRestDocumentationConfigurer configurer) {
        configurer.snippets().withTemplateFormat(TemplateFormats.markdown());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to make use of Spring REST Docs support for a parameterized output directory, you can create a <code>RestDocumentationResultHandler</code> bean.
The auto-configuration calls <code>alwaysDo</code> with this result handler, thereby causing each <code>MockMvc</code> call to automatically generate the default snippets.
The following example shows a <code>RestDocumentationResultHandler</code> being defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@TestConfiguration(proxyBeanMethods = false)
static class ResultHandlerConfiguration {

    @Bean
    public RestDocumentationResultHandler restDocumentation() {
        return MockMvcRestDocumentation.document("{method-name}");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-web-test-client"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-web-test-client"></a>Auto-configured Spring REST Docs Tests with WebTestClient</h5>
<div class="paragraph">
<p><code>@AutoConfigureRestDocs</code> can also be used with <code>WebTestClient</code> when testing reactive web applications.
You can inject it by using <code>@Autowired</code> and use it in your tests as you normally would when using <code>@WebFluxTest</code> and Spring REST Docs, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing.restdocs.webclient;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
import org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;
import org.springframework.test.web.reactive.server.WebTestClient;

import static org.springframework.restdocs.webtestclient.WebTestClientRestDocumentation.document;

@WebFluxTest
@AutoConfigureRestDocs
class UsersDocumentationTests {

    @Autowired
    private WebTestClient webTestClient;

    @Test
    void listUsers() {
        // @formatter:off
        this.webTestClient
            .get().uri("/")
        .exchange()
        .expectStatus()
            .isOk()
        .expectBody()
            .consumeWith(document("list-users"));
        // @formatter:on
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you require more control over Spring REST Docs configuration than offered by the attributes of <code>@AutoConfigureRestDocs</code>, you can use a <code>RestDocsWebTestClientConfigurationCustomizer</code> bean, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing.restdocs.webclient;

import org.springframework.boot.test.autoconfigure.restdocs.RestDocsWebTestClientConfigurationCustomizer;
import org.springframework.boot.test.context.TestConfiguration;
import org.springframework.restdocs.webtestclient.WebTestClientRestDocumentationConfigurer;

@TestConfiguration(proxyBeanMethods = false)
public class AdvancedRestDocsConfiguration implements RestDocsWebTestClientConfigurationCustomizer {

    @Override
    public void customize(WebTestClientRestDocumentationConfigurer configurer) {
        configurer.snippets().withEncoding("UTF-8");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-rest-assured"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-rest-assured"></a>Auto-configured Spring REST Docs Tests with REST Assured</h5>
<div class="paragraph">
<p><code>@AutoConfigureRestDocs</code> makes a <code>RequestSpecification</code> bean, preconfigured to use Spring REST Docs, available to your tests.
You can inject it by using <code>@Autowired</code> and use it in your tests as you normally would when using REST Assured and Spring REST Docs, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing.restdocs.restassured;

import io.restassured.specification.RequestSpecification;
import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.boot.web.server.LocalServerPort;

import static io.restassured.RestAssured.given;
import static org.hamcrest.Matchers.is;
import static org.springframework.restdocs.restassured3.RestAssuredRestDocumentation.document;

@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
@AutoConfigureRestDocs
class UserDocumentationTests {

    @Test
    void listUsers(@Autowired RequestSpecification documentationSpec, @LocalServerPort int port) {
        // @formatter:off
        given(documentationSpec)
            .filter(document("list-users"))
        .when()
            .port(port)
            .get("/")
        .then().assertThat()
            .statusCode(is(200));
        // @formatter:on
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you require more control over Spring REST Docs configuration than offered by the attributes of <code>@AutoConfigureRestDocs</code>, a <code>RestDocsRestAssuredConfigurationCustomizer</code> bean can be used, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing.restdocs.restassured;

import org.springframework.boot.test.autoconfigure.restdocs.RestDocsRestAssuredConfigurationCustomizer;
import org.springframework.boot.test.context.TestConfiguration;
import org.springframework.restdocs.restassured3.RestAssuredRestDocumentationConfigurer;
import org.springframework.restdocs.templates.TemplateFormats;

@TestConfiguration(proxyBeanMethods = false)
public class AdvancedRestDocsConfiguration implements RestDocsRestAssuredConfigurationCustomizer {

    @Override
    public void customize(RestAssuredRestDocumentationConfigurer configurer) {
        configurer.snippets().withTemplateFormat(TemplateFormats.markdown());
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-autoconfigured-webservices"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-webservices"></a>2.3.26. Auto-configured Spring Web Services Tests</h4>
<div class="paragraph">
<p>You can use <code>@WebServiceClientTest</code> to test applications that use call web services using the Spring Web Services project.
By default, it configures a mock <code>WebServiceServer</code> bean and automatically customizes your <code>WebServiceTemplateBuilder</code>.
(For more about using Web Services with Spring Boot, see "<a href="#boot-features-webservices">[boot-features-webservices]</a>", earlier in this chapter.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of the auto-configuration settings that are enabled by <code>@WebServiceClientTest</code> can be <a href="appendix-test-auto-configuration.html#test-auto-configuration">found in the appendix</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows the <code>@WebServiceClientTest</code> annotation in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@WebServiceClientTest(ExampleWebServiceClient.class)
class WebServiceClientIntegrationTests {

    @Autowired
    private MockWebServiceServer server;

    @Autowired
    private ExampleWebServiceClient client;

    @Test
    void mockServerCall() {
        this.server.expect(payload(new StringSource("&lt;request/&gt;"))).andRespond(
                withPayload(new StringSource("&lt;response&gt;&lt;status&gt;200&lt;/status&gt;&lt;/response&gt;")));
        assertThat(this.client.test()).extracting(Response::getStatus).isEqualTo(200);
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-auto-configured-additional-auto-config"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-auto-configured-additional-auto-config"></a>2.3.27. Additional Auto-configuration and Slicing</h4>
<div class="paragraph">
<p>Each slice provides one or more <code>@AutoConfigure&#8230;&#8203;</code> annotations that namely defines the auto-configurations that should be included as part of a slice.
Additional auto-configurations can be added on a test-by-test basis by creating a custom <code>@AutoConfigure&#8230;&#8203;</code> annotation or by adding <code>@ImportAutoConfiguration</code> to the test as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@JdbcTest
@ImportAutoConfiguration(IntegrationAutoConfiguration.class)
class ExampleJdbcTests {

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure to not use the regular <code>@Import</code> annotation to import auto-configurations as they are handled in a specific way by Spring Boot.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, additional auto-configurations can be added for any use of a slice annotation by registering them in <code>META-INF/spring.factories</code> as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.springframework.boot.test.autoconfigure.jdbc.JdbcTest=com.example.IntegrationAutoConfiguration</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A slice or <code>@AutoConfigure&#8230;&#8203;</code> annotation can be customized this way as long as it is meta-annotated with <code>@ImportAutoConfiguration</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-testing-user-configuration"><a class="anchor" href="#boot-features-testing-spring-boot-applications-testing-user-configuration"></a>2.3.28. User Configuration and Slicing</h4>
<div class="paragraph">
<p>If you <a href="using-spring-boot.html#using-boot-structuring-your-code">structure your code</a> in a sensible way, your <code>@SpringBootApplication</code> class is <a href="#boot-features-testing-spring-boot-applications-detecting-config">used by default</a> as the configuration of your tests.</p>
</div>
<div class="paragraph">
<p>It then becomes important not to litter the application&#8217;s main class with configuration settings that are specific to a particular area of its functionality.</p>
</div>
<div class="paragraph">
<p>Assume that you are using Spring Batch and you rely on the auto-configuration for it.
You could define your <code>@SpringBootApplication</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@SpringBootApplication
@EnableBatchProcessing
public class SampleApplication { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because this class is the source configuration for the test, any slice test actually tries to start Spring Batch, which is definitely not what you want to do.
A recommended approach is to move that area-specific configuration to a separate <code>@Configuration</code> class at the same level as your application, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration(proxyBeanMethods = false)
@EnableBatchProcessing
public class BatchConfiguration { ... }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Depending on the complexity of your application, you may either have a single <code>@Configuration</code> class for your customizations or one class per domain area.
The latter approach lets you enable it in one of your tests, if necessary, with the <code>@Import</code> annotation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Test slices exclude <code>@Configuration</code> classes from scanning.
For example, for a <code>@WebMvcTest</code>, the following configuration will not include the given <code>WebMvcConfigurer</code> bean in the application context loaded by the test slice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Configuration
public class WebConfiguration {
    @Bean
    public WebMvcConfigurer testConfigurer() {
        return new WebMvcConfigurer() {
            ...
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration below will, however, cause the custom <code>WebMvcConfigurer</code> to be loaded by the test slice.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Component
public class TestWebMvcConfigurer implements WebMvcConfigurer {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another source of confusion is classpath scanning.
Assume that, while you structured your code in a sensible way, you need to scan an additional package.
Your application may resemble the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@SpringBootApplication
@ComponentScan({ "com.example.app", "org.acme.another" })
public class SampleApplication { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so effectively overrides the default component scan directive with the side effect of scanning those two packages regardless of the slice that you chose.
For instance, a <code>@DataJpaTest</code> seems to suddenly scan components and user configurations of your application.
Again, moving the custom directive to a separate class is a good way to fix this issue.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If this is not an option for you, you can create a <code>@SpringBootConfiguration</code> somewhere in the hierarchy of your test so that it is used instead.
Alternatively, you can specify a source for your test, which disables the behavior of finding a default one.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-testing-spring-boot-applications-with-spock"><a class="anchor" href="#boot-features-testing-spring-boot-applications-with-spock"></a>2.3.29. Using Spock to Test Spring Boot Applications</h4>
<div class="paragraph">
<p>If you wish to use Spock to test a Spring Boot application, you should add a dependency on Spock&#8217;s <code>spock-spring</code> module to your application&#8217;s build.
<code>spock-spring</code> integrates Spring&#8217;s test framework into Spock.
See <a href="http://spockframework.org/spock/docs/2.0-M4/modules.html#_spring_module">the documentation for Spock&#8217;s Spring module</a> for further details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of Spring Boot 2.5.x and its support for Groovy 3.x you have two options to make use of Spock:
Either use the latest Spock 2.0 milestone or release that is compatible with Groovy 3.x or stick with Spock 1.3 and downgrade Spring Boot&#8217;s Groovy version to 2.5.x.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="boot-features-test-utilities"><a class="anchor" href="#boot-features-test-utilities"></a>2.4. Test Utilities</h3>
<div class="paragraph">
<p>A few test utility classes that are generally useful when testing your application are packaged as part of <code>spring-boot</code>.</p>
</div>
<div class="sect3">
<h4 id="boot-features-configfileapplicationcontextinitializer-test-utility"><a class="anchor" href="#boot-features-configfileapplicationcontextinitializer-test-utility"></a>2.4.1. ConfigFileApplicationContextInitializer</h4>
<div class="paragraph">
<p><code>ConfigFileApplicationContextInitializer</code> is an <code>ApplicationContextInitializer</code> that you can apply to your tests to load Spring Boot <code>application.properties</code> files.
You can use it when you do not need the full set of features provided by <code>@SpringBootTest</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ContextConfiguration(classes = Config.class,
    initializers = ConfigFileApplicationContextInitializer.class)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>ConfigFileApplicationContextInitializer</code> alone does not provide support for <code>@Value("${&#8230;&#8203;}")</code> injection.
Its only job is to ensure that <code>application.properties</code> files are loaded into Spring&#8217;s <code>Environment</code>.
For <code>@Value</code> support, you need to either additionally configure a <code>PropertySourcesPlaceholderConfigurer</code> or use <code>@SpringBootTest</code>, which auto-configures one for you.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-test-property-values"><a class="anchor" href="#boot-features-test-property-values"></a>2.4.2. TestPropertyValues</h4>
<div class="paragraph">
<p><code>TestPropertyValues</code> lets you quickly add properties to a <code>ConfigurableEnvironment</code> or <code>ConfigurableApplicationContext</code>.
You can call it with <code>key=value</code> strings, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">TestPropertyValues.of("org=Spring", "name=Boot").applyTo(env);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-output-capture-test-utility"><a class="anchor" href="#boot-features-output-capture-test-utility"></a>2.4.3. OutputCapture</h4>
<div class="paragraph">
<p><code>OutputCapture</code> is a JUnit <code>Extension</code> that you can use to capture <code>System.out</code> and <code>System.err</code> output.
To use add <code>@ExtendWith(OutputCaptureExtension.class)</code> and inject <code>CapturedOutput</code> as an argument to your test class constructor or test method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;

import org.springframework.boot.test.system.CapturedOutput;
import org.springframework.boot.test.system.OutputCaptureExtension;

import static org.assertj.core.api.Assertions.assertThat;

@ExtendWith(OutputCaptureExtension.class)
class OutputCaptureTests {

    @Test
    void testName(CapturedOutput output) {
        System.out.println("Hello World!");
        assertThat(output).contains("World");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boot-features-rest-templates-test-utility"><a class="anchor" href="#boot-features-rest-templates-test-utility"></a>2.4.4. TestRestTemplate</h4>
<div class="paragraph">
<p><code>TestRestTemplate</code> is a convenience alternative to Spring&#8217;s <code>RestTemplate</code> that is useful in integration tests.
You can get a vanilla template or one that sends Basic HTTP authentication (with a username and password).
In either case, the template behaves in a test-friendly way by not throwing exceptions on server-side errors.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Spring Framework 5.0 provides a new <code>WebTestClient</code> that works for <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests">WebFlux integration tests</a> and both <a href="#boot-features-testing-spring-boot-applications-testing-with-running-server">WebFlux and MVC end-to-end testing</a>.
It provides a fluent API for assertions, unlike <code>TestRestTemplate</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is recommended, but not mandatory, to use the Apache HTTP Client (version 4.3.2 or better).
If you have that on your classpath, the <code>TestRestTemplate</code> responds by configuring the client appropriately.
If you do use Apache&#8217;s HTTP client, some additional test-friendly features are enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redirects are not followed (so you can assert the response location).</p>
</li>
<li>
<p>Cookies are ignored (so the template is stateless).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>TestRestTemplate</code> can be instantiated directly in your integration tests, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class MyTest {

    private TestRestTemplate template = new TestRestTemplate();

    @Test
    public void testRequest() throws Exception {
        HttpHeaders headers = this.template.getForEntity(
                "https://myhost.example.com/example", String.class).getHeaders();
        assertThat(headers.getLocation()).hasHost("other.example.com");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you use the <code>@SpringBootTest</code> annotation with <code>WebEnvironment.RANDOM_PORT</code> or <code>WebEnvironment.DEFINED_PORT</code>, you can inject a fully configured <code>TestRestTemplate</code> and start using it.
If necessary, additional customizations can be applied through the <code>RestTemplateBuilder</code> bean.
Any URLs that do not specify a host and port automatically connect to the embedded server, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/*
 * Copyright 2012-2021 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.boot.docs.springbootfeatures.testing.webclient;

import java.time.Duration;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.boot.test.context.TestConfiguration;
import org.springframework.boot.test.web.client.TestRestTemplate;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.http.HttpHeaders;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
class SampleWebClientTests {

    @Autowired
    private TestRestTemplate template;

    @Test
    void testRequest() {
        HttpHeaders headers = this.template.getForEntity("/example", String.class).getHeaders();
        assertThat(headers.getLocation()).hasHost("other.example.com");
    }

    @TestConfiguration(proxyBeanMethods = false)
    static class RestTemplateBuilderConfiguration {

        @Bean
        RestTemplateBuilder restTemplateBuilder() {
            return new RestTemplateBuilder().setConnectTimeout(Duration.ofSeconds(1))
                    .setReadTimeout(Duration.ofSeconds(1));
        }

    }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-31 23:34:37 +0900
</div>
</div>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>